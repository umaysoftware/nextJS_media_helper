<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Helper Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #4a90e2;
            color: white;
            border: none;
            border-radius: 5px;
        }
        button:hover {
            background-color: #357abd;
        }
        .results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        .file-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background-color: #f9f9f9;
        }
        .file-card h3 {
            margin-top: 0;
            color: #333;
        }
        .file-info {
            margin: 10px 0;
            font-size: 14px;
            color: #666;
        }
        .preview {
            width: 100%;
            max-width: 300px;
            height: auto;
            border-radius: 5px;
            margin-top: 10px;
        }
        .thumbnail-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #ddd;
        }
        .thumbnail-section h4 {
            margin: 0 0 10px 0;
            color: #666;
            font-size: 14px;
        }
        .error {
            color: red;
            padding: 10px;
            background-color: #ffe0e0;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Media Helper Test</h1>
    
    <div class="buttons">
        <button onclick="testImage()">Test Image Picker</button>
        <button onclick="testVideo()">Test Video Picker</button>
        <button onclick="testAudio()">Test Audio Picker</button>
        <button onclick="testMixed()">Test Mixed Media</button>
    </div>
    
    <div id="error" class="error" style="display: none;"></div>
    <div id="results" class="results"></div>

    <script type="module">
        // Import from the built module
        import { MediaHelper } from './dist/index.js';
        
        window.MediaHelper = MediaHelper;
        
        window.testImage = async function() {
            try {
                const images = await MediaHelper.pickImage({
                    rules: {
                        willGenerateBase64: true,
                        willGenerateBlob: true,
                        willGenerateThumbnail: true,
                        maxSelectionCount: 3,
                        maxFileSize: 10 * 1024 * 1024,
                        imageCompression: 'medium',
                        thumbnailSize: 'medium',
                        thumbnailFormat: 'jpeg',
                        thumbnailQuality: 'high'
                    }
                });
                
                displayResults(images);
            } catch (error) {
                showError(error);
            }
        };
        
        window.testVideo = async function() {
            try {
                const videos = await MediaHelper.pickVideo({
                    rules: {
                        willGenerateBlob: true,
                        willGenerateThumbnail: true,
                        maxSelectionCount: 2,
                        maxFileSize: 100 * 1024 * 1024,
                        videoDurationLimit: 300,
                        thumbnailSize: 'large'
                    }
                });
                
                displayResults(videos);
            } catch (error) {
                showError(error);
            }
        };
        
        window.testAudio = async function() {
            try {
                const audios = await MediaHelper.pickSound({
                    rules: {
                        willGenerateFile: true,
                        willGenerateThumbnail: true,
                        maxSelectionCount: 5,
                        maxFileSize: 20 * 1024 * 1024,
                        audioDurationLimit: 600,
                        thumbnailSize: 'medium'
                    }
                });
                
                displayResults(audios);
            } catch (error) {
                showError(error);
            }
        };
        
        window.testMixed = async function() {
            try {
                const files = await MediaHelper.pickFile({
                    rules: [
                        {
                            allowedMimeTypes: ['image/jpeg', 'image/png'],
                            maxFileSize: 5 * 1024 * 1024,
                            willGenerateBase64: true,
                            willGenerateThumbnail: true,
                            thumbnailSize: 'small'
                        },
                        {
                            allowedMimeTypes: ['video/mp4'],
                            maxFileSize: 50 * 1024 * 1024,
                            willGenerateBlob: true,
                            willGenerateThumbnail: true,
                            thumbnailSize: 'medium'
                        }
                    ]
                });
                
                displayResults(files);
            } catch (error) {
                showError(error);
            }
        };
        
        function displayResults(files) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '';
            document.getElementById('error').style.display = 'none';
            
            files.forEach(file => {
                const card = document.createElement('div');
                card.className = 'file-card';
                
                let content = `
                    <h3>${file.name}</h3>
                    <div class="file-info">
                        <p><strong>Size:</strong> ${formatFileSize(file.size)}</p>
                        <p><strong>Type:</strong> ${file.mimeType}</p>
                        <p><strong>Extension:</strong> ${file.extension}</p>
                    </div>
                `;
                
                // Show preview based on type
                if (file.type === 'image' && file.base64) {
                    content += `<img src="${file.base64}" class="preview" alt="${file.name}">`;
                } else if (file.type === 'video' && file.blob) {
                    const videoUrl = URL.createObjectURL(file.blob);
                    content += `<video src="${videoUrl}" class="preview" controls></video>`;
                } else if (file.type === 'audio' && file.file) {
                    const audioUrl = URL.createObjectURL(file.file);
                    content += `<audio src="${audioUrl}" controls style="width: 100%;"></audio>`;
                }
                
                // Show thumbnail if exists
                if (file.thumbnail) {
                    content += `
                        <div class="thumbnail-section">
                            <h4>Thumbnail:</h4>
                    `;
                    
                    if (file.thumbnail.base64) {
                        content += `<img src="${file.thumbnail.base64}" class="preview" alt="Thumbnail">`;
                    } else if (file.thumbnail.blob) {
                        const thumbUrl = URL.createObjectURL(file.thumbnail.blob);
                        content += `<img src="${thumbUrl}" class="preview" alt="Thumbnail">`;
                    }
                    
                    content += `
                            <p style="font-size: 12px; color: #888;">
                                Size: ${formatFileSize(file.thumbnail.size)}
                            </p>
                        </div>
                    `;
                }
                
                card.innerHTML = content;
                resultsDiv.appendChild(card);
            });
        }
        
        function showError(error) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = error.message;
            errorDiv.style.display = 'block';
            console.error('Error:', error);
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
    </script>
</body>
</html>